# ChemDescriptorML (CDML) - ì²¨ë¶€ íŒŒì¼ êµ¬ì„±

ì²¨ë¶€í•œ íŒŒì¼ êµ¬ì„±ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

---

## íŒŒì¼ êµ¬ì¡°

```
descriptor-toolkit/
â”œâ”€â”€ ğŸ“ docs/                          # ë¬¸ì„œ
â”‚   â”œâ”€â”€ í”„ë¡œê·¸ë¨_êµ¬ë™ë°©ë²•.md           # í”„ë¡œê·¸ë¨ ì‚¬ìš© ê°€ì´ë“œ
â”‚   â””â”€â”€ ì²¨ë¶€_íŒŒì¼_êµ¬ì„±.md              # ë³¸ ë¬¸ì„œ
â”‚
â”œâ”€â”€ ğŸ“ Chem_Descriptor_ML/            # ë©”ì¸ íŒ¨í‚¤ì§€
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ cli.py                        # CLI ì§„ì…ì 
â”‚   â”œâ”€â”€ ğŸ“ config/                    # ì„¤ì • ê´€ë¦¬
â”‚   â”œâ”€â”€ ğŸ“ filtering/                 # í•„í„°ë§ íŒŒì´í”„ë¼ì¸
â”‚   â”œâ”€â”€ ğŸ“ preprocessing/             # ì „ì²˜ë¦¬ ëª¨ë“ˆ
â”‚   â”œâ”€â”€ ğŸ“ ml/                        # ML í•™ìŠµ ëª¨ë“ˆ
â”‚   â””â”€â”€ ğŸ“ workflows/                 # ì›Œí¬í”Œë¡œìš°
â”‚
â”œâ”€â”€ ğŸ“ reference/                     # ì°¸ì¡° ë°ì´í„° ë° ì˜ˆì‹œ ê²°ê³¼
â”‚   â”œâ”€â”€ train_samples_61.csv          # Track 2 í•™ìŠµ ë°ì´í„° (61ê°œ)
â”‚   â”œâ”€â”€ test_samples_16.csv           # Track 2 í…ŒìŠ¤íŠ¸ ë°ì´í„° (16ê°œ)
â”‚   â”œâ”€â”€ best_model_result.json        # ìµœì  ëª¨ë¸ ì •ë³´
â”‚   â”œâ”€â”€ ğŸ“ example_output/            # ì˜ˆì‹œ ì‹¤í–‰ ê²°ê³¼
â”‚   â”‚   â”œâ”€â”€ ğŸ“ track1/                # Track 1 í•„í„°ë§ ê²°ê³¼
â”‚   â”‚   â””â”€â”€ ğŸ“ track2/                # Track 2 ML í•™ìŠµ ê²°ê³¼
â”‚   â””â”€â”€ ğŸ“ plots/                     # ì‹œê°í™” í”Œë¡¯
â”‚
â”œâ”€â”€ setup.py                          # íŒ¨í‚¤ì§€ ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ requirements.txt                  # ì˜ì¡´ì„± ëª©ë¡
â”œâ”€â”€ CLAUDE.md                         # í”„ë¡œì íŠ¸ ì»¨í…ìŠ¤íŠ¸
â””â”€â”€ README.md                         # í”„ë¡œì íŠ¸ ì†Œê°œ
```

---

## ìƒì„¸ íŒŒì¼ ì„¤ëª…

### 00. ë¬¸ì„œ

| íŒŒì¼ | ì„¤ëª… |
|------|------|
| `docs/í”„ë¡œê·¸ë¨_êµ¬ë™ë°©ë²•.md` | í”„ë¡œê·¸ë¨ ì„¤ì¹˜ ë° ì‹¤í–‰ ë°©ë²• ìƒì„¸ ê°€ì´ë“œ |
| `docs/ì²¨ë¶€_íŒŒì¼_êµ¬ì„±.md` | ì²¨ë¶€ íŒŒì¼ êµ¬ì„± ì„¤ëª… (ë³¸ ë¬¸ì„œ) |
| `CLAUDE.md` | í”„ë¡œì íŠ¸ ì»¨í…ìŠ¤íŠ¸ ë° ê°œë°œ ì´ë ¥ |
| `README.md` | í”„ë¡œì íŠ¸ ê°œìš” |

---

### 01. Environment (í™˜ê²½ ì„¤ì •)

| íŒŒì¼ | ì„¤ëª… |
|------|------|
| `setup.py` | íŒ¨í‚¤ì§€ ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸ (`pip install -e .` ì‚¬ìš©) |
| `requirements.txt` | Python ì˜ì¡´ì„± ëª©ë¡ |

**ì£¼ìš” ì˜ì¡´ì„±:**
- `numpy>=1.24.0` - ìˆ˜ì¹˜ ì—°ì‚°
- `pandas>=2.0.0` - ë°ì´í„° ì²˜ë¦¬
- `pyarrow>=12.0.0` - Parquet íŒŒì¼ I/O
- `torch>=2.0.0` - GPU ê°€ì† (ì„ íƒ)
- `rdkit>=2023.3.1` - ë¶„ì ì²˜ë¦¬
- `mordred>=1.2.0` - Descriptor ê³„ì‚°
- `scikit-learn>=1.3.0` - ML ì•Œê³ ë¦¬ì¦˜
- `xgboost`, `lightgbm` - ë¶€ìŠ¤íŒ… ëª¨ë¸ (ì„ íƒ)

**ì„¤ì¹˜ ë°©ë²•:**
```bash
pip install -r requirements.txt
pip install -e .
pip install xgboost lightgbm  # ì„ íƒ
```

---

### 02. Code (ì½”ë“œ)

#### 2.1 ë©”ì¸ íŒ¨í‚¤ì§€ (`Chem_Descriptor_ML/`)

| íŒŒì¼/í´ë” | ì„¤ëª… |
|-----------|------|
| `cli.py` | ëª…ë ¹ì¤„ ì¸í„°í˜ì´ìŠ¤ (CLI) ì§„ì…ì  |
| `config/` | ì„¤ì • í´ë˜ìŠ¤ ì •ì˜ (DeviceConfig, IOConfig ë“±) |
| `filtering/` | 4ë‹¨ê³„ í•„í„°ë§ íŒŒì´í”„ë¼ì¸ êµ¬í˜„ |
| `preprocessing/` | ë°ì´í„° ì „ì²˜ë¦¬ (XML íŒŒì‹±, Descriptor ê³„ì‚°) |
| `ml/` | ML ëª¨ë¸ í•™ìŠµ ëª¨ë“ˆ |
| `workflows/` | í†µí•© ì›Œí¬í”Œë¡œìš° |

#### 2.2 í•„í„°ë§ íŒŒì´í”„ë¼ì¸ (`filtering/`)

| ëª¨ë“ˆ | ì„¤ëª… |
|------|------|
| `pipeline.py` | ë©”ì¸ íŒŒì´í”„ë¼ì¸ í´ë˜ìŠ¤ |
| `passes/pass0_sampling.py` | Pass 0: ë°ì´í„° ìƒ˜í”Œë§ |
| `passes/pass1_statistics.py` | Pass 1: í†µê³„ ë° ë¶„ì‚° í•„í„°ë§ |
| `passes/pass2_spearman.py` | Pass 2: Spearman ìƒê´€ ê¸°ë°˜ í´ëŸ¬ìŠ¤í„°ë§ |
| `passes/pass3_vif.py` | Pass 3: VIF ë‹¤ì¤‘ê³µì„ ì„± í•„í„°ë§ |
| `passes/pass4_nonlinear.py` | Pass 4: HSIC/RDC ë¹„ì„ í˜• ìƒê´€ í•„í„°ë§ |

#### 2.3 ML ëª¨ë“ˆ (`ml/`)

| íŒŒì¼ | ì„¤ëª… |
|------|------|
| `ensemble.py` | OptimalMLEnsemble í´ë˜ìŠ¤ - 8ê°œ ëª¨ë¸ ì•™ìƒë¸” í•™ìŠµ ë° ì‹œê°í™” |

**ì§€ì› ëª¨ë¸ (8ê°œ):**
- RandomForest, ExtraTrees (íŠ¸ë¦¬ ê¸°ë°˜)
- XGBoost, LightGBM (ë¶€ìŠ¤íŒ…)
- Ridge, Lasso, ElasticNet (ì„ í˜•)
- GPR (ê°€ìš°ì‹œì•ˆ í”„ë¡œì„¸ìŠ¤)

**ì‹œê°í™” ê¸°ëŠ¥:**
- `plot_model_comparison()` - ëª¨ë¸ë³„ ì„±ëŠ¥ ë¹„êµ ì°¨íŠ¸
- `plot_best_model_analysis()` - ì˜ˆì¸¡ vs ì‹¤ì œ, ì”ì°¨ ë¶„ì„, Feature Importance
- `generate_all_plots()` - ì „ì²´ í”Œë¡¯ ìƒì„±

---

### 03. Reference (ì°¸ì¡° ë°ì´í„°)

#### 3.1 í•™ìŠµ/í…ŒìŠ¤íŠ¸ ë°ì´í„°

| íŒŒì¼ | ìƒ˜í”Œ ìˆ˜ | ì»¬ëŸ¼ ìˆ˜ | ì„¤ëª… |
|------|---------|---------|------|
| `train_samples_61.csv` | 61 | 870 | í•™ìŠµ ë°ì´í„° (863ê°œ descriptor + ë©”íƒ€ë°ì´í„°) |
| `test_samples_16.csv` | 16 | 870 | í…ŒìŠ¤íŠ¸ ë°ì´í„° (ì™¸ë¶€ ê²€ì¦ìš©) |

**ë°ì´í„° ì»¬ëŸ¼ êµ¬ì„±:**
- ë©”íƒ€ë°ì´í„°: CID, isomeric_smiles, standardized_smiles, parse_source, standardization_status, source_file
- íƒ€ê²Ÿ: pLeach
- Descriptor: 863ê°œ (AATS0Z, AATS0are, ... ë“±)

#### 3.2 ìµœì  ëª¨ë¸ ì •ë³´

| íŒŒì¼ | ì„¤ëª… |
|------|------|
| `best_model_result.json` | Random Seed Searchë¡œ ì°¾ì€ ìµœì  ëª¨ë¸ ì •ë³´ |

**ìµœì  ëª¨ë¸ ê²°ê³¼:**
- ëª¨ë¸: XGBoost
- Descriptor ìˆ˜: 35ê°œ
- Test RÂ²: 0.7323
- íƒìƒ‰ seed: 986

---

### 04. Example Output (ì˜ˆì‹œ ê²°ê³¼)

`reference/example_output/` í´ë”ì— ì „ì²´ ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ê²°ê³¼ê°€ ìˆìŠµë‹ˆë‹¤.

#### 4.1 Track 1 ê²°ê³¼ (`example_output/track1/`)

`cdml run` í•„í„°ë§ íŒŒì´í”„ë¼ì¸ ê²°ê³¼ì…ë‹ˆë‹¤.

```
example_output/track1/
â”œâ”€â”€ sampled_data.parquet           # Pass 0: ìƒ˜í”Œë§ëœ ë°ì´í„°
â”œâ”€â”€ pass1_variance_filtering.json  # Pass 1: ë¶„ì‚° í•„í„°ë§ ê²°ê³¼
â”œâ”€â”€ pass1_columns.txt              # Pass 1: í†µê³¼í•œ ì»¬ëŸ¼ ëª©ë¡
â”œâ”€â”€ pass1_stats.npz                # Pass 1: í†µê³„ ì •ë³´
â”œâ”€â”€ pass2_spearman.json            # Pass 2: Spearman í´ëŸ¬ìŠ¤í„°ë§ ê²°ê³¼
â”œâ”€â”€ pass2_columns.txt              # Pass 2: ëŒ€í‘œ descriptor ëª©ë¡
â”œâ”€â”€ pass2_spearman_matrix.npy      # Pass 2: ìƒê´€ í–‰ë ¬
â”œâ”€â”€ pass3_vif.json                 # Pass 3: VIF í•„í„°ë§ ê²°ê³¼
â”œâ”€â”€ pass3_columns.txt              # Pass 3: í†µê³¼í•œ ì»¬ëŸ¼ ëª©ë¡
â”œâ”€â”€ pass4_nonlinear.json           # Pass 4: ë¹„ì„ í˜• í•„í„°ë§ ê²°ê³¼
â”œâ”€â”€ final_descriptors.txt          # ìµœì¢… 71ê°œ descriptor ëª©ë¡
â””â”€â”€ final_cluster_info.json        # í´ëŸ¬ìŠ¤í„° êµ¬ì¡° (ëŒ€í‘œ + ëŒ€ì•ˆ ë§¤í•‘)
```

| íŒŒì¼ | ì„¤ëª… |
|------|------|
| `pass1_*.json/txt/npz` | Pass 1 ë¶„ì‚°/ê²°ì¸¡ì¹˜ í•„í„°ë§ ê²°ê³¼ |
| `pass2_*.json/txt/npy` | Pass 2 Spearman ìƒê´€ í´ëŸ¬ìŠ¤í„°ë§ ê²°ê³¼ |
| `pass3_*.json/txt` | Pass 3 VIF ë‹¤ì¤‘ê³µì„ ì„± í•„í„°ë§ ê²°ê³¼ |
| `pass4_nonlinear.json` | Pass 4 HSIC/RDC ë¹„ì„ í˜• í•„í„°ë§ ê²°ê³¼ |
| `final_descriptors.txt` | ìµœì¢… ì„ íƒëœ descriptor ëª©ë¡ |
| `final_cluster_info.json` | í´ëŸ¬ìŠ¤í„° êµ¬ì¡° (ëŒ€í‘œ + ëŒ€ì•ˆ descriptor ë§¤í•‘) |

**í•„í„°ë§ ê²°ê³¼ ìš”ì•½:**

| ë‹¨ê³„ | ì…ë ¥ | ì¶œë ¥ | ì„¤ëª… |
|------|------|------|------|
| Pass 1 | 1,775 descriptors | ~900 | ë¶„ì‚°/ê²°ì¸¡ì¹˜ í•„í„°ë§ |
| Pass 2 | ~900 descriptors | í´ëŸ¬ìŠ¤í„°ë§ | Spearman ìƒê´€ í´ëŸ¬ìŠ¤í„°ë§ |
| Pass 3 | í´ëŸ¬ìŠ¤í„° ëŒ€í‘œ | ~80 | VIF ë‹¤ì¤‘ê³µì„ ì„± í•„í„°ë§ |
| Pass 4 | ~80 descriptors | 71 | HSIC/RDC ë¹„ì„ í˜• í•„í„°ë§ |

#### 4.2 Track 2 ê²°ê³¼ (`example_output/track2/`)

ML ëª¨ë¸ í•™ìŠµ ê²°ê³¼ì…ë‹ˆë‹¤. Random Seed Searchë¥¼ í†µí•´ ìµœì ì˜ descriptor ì¡°í•©ì„ íƒìƒ‰í–ˆìŠµë‹ˆë‹¤.

| íŒŒì¼ | ì„¤ëª… |
|------|------|
| `ml_results.json` | ì „ì²´ ëª¨ë¸ ì‹¤í—˜ ê²°ê³¼ |
| `model_comparison.csv` | 8ê°œ ëª¨ë¸ ì„±ëŠ¥ ë¹„êµí‘œ |
| `pred_vs_actual.png` | ì˜ˆì¸¡ê°’ vs ì‹¤ì œê°’ í”Œë¡¯ |
| `residual_analysis.png` | ì”ì°¨ ë¶„ì„ í”Œë¡¯ |
| `feature_importance.png` | Top 15 Feature Importance |
| `model_comparison.png` | ëª¨ë¸ ë¹„êµ ì°¨íŠ¸ |
| `all_models_comparison.png` | ì „ì²´ ëª¨ë¸ ë¹„êµ (2x4 grid) |
| `test_prediction_comparison.png` | í…ŒìŠ¤íŠ¸ì…‹ ì˜ˆì¸¡ ë¹„êµ |

**8ê°œ ëª¨ë¸ ì•™ìƒë¸” ë¹„êµ ê²°ê³¼:**

| Rank | Model | CV RÂ² | Test RÂ² | RMSE |
|------|-------|-------|---------|------|
| 1 | **XGBoost** | -0.56 Â± 0.87 | **0.7527** | 1.31 |
| 2 | RandomForest | -0.25 Â± 0.46 | 0.5798 | 1.71 |
| 3 | LightGBM | -0.17 Â± 0.21 | 0.2153 | 2.34 |
| 4 | ExtraTrees | -0.17 Â± 0.31 | 0.0607 | 2.56 |
| 5 | GPR | -0.07 Â± 0.07 | -0.1157 | 2.79 |
| 6 | Lasso | -0.99 Â± 0.65 | -4.91 | 6.43 |
| 7 | ElasticNet | -0.88 Â± 0.67 | -5.36 | 6.67 |
| 8 | Ridge | -1.19 Â± 0.75 | -9.77 | 8.68 |

**Best Model: XGBoost (35 Descriptors)**
- Test RÂ²: **0.7527**
- Test RMSE: 1.31
- Test MAE: 1.11

#### 4.3 ì‹œê°í™” í”Œë¡¯ (`plots/`)

ìµœì  ëª¨ë¸ì˜ ì‹œê°í™” ê²°ê³¼ì…ë‹ˆë‹¤.

| íŒŒì¼ | ì„¤ëª… |
|------|------|
| `pred_vs_actual.png` | ì˜ˆì¸¡ê°’ vs ì‹¤ì œê°’ ì‚°ì ë„ |
| `residual_analysis.png` | ì”ì°¨ ë¶„í¬ ë° íŒ¨í„´ ë¶„ì„ |
| `feature_importance.png` | Top 15 Feature Importance |
| `test_prediction_comparison.png` | í…ŒìŠ¤íŠ¸ì…‹ ìƒ˜í”Œë³„ ì˜ˆì¸¡ ë¹„êµ |

---

## ì£¼ìš” íŒŒì¼ ë‚´ìš© ì„¤ëª…

### `final_cluster_info.json` êµ¬ì¡°

Track 1 í•„í„°ë§ ê²°ê³¼ë¡œ ìƒì„±ë˜ëŠ” í´ëŸ¬ìŠ¤í„° êµ¬ì¡° íŒŒì¼ì…ë‹ˆë‹¤.

```json
{
  "metadata": {
    "description": "Final cluster structure with complete Pass2 expansion",
    "version": "6.0",
    "total_descriptors": 71,
    "descriptors_with_alternatives": 66,
    "standalone_descriptors": 5,
    "total_alternative_descriptors": 857
  },
  "statistics": {
    "total_descriptors": 71,
    "cluster_size_distribution": { "1": 5, "2": 7, "3": 8, ... },
    "largest_clusters": [
      {"descriptor": "ATSC3c", "cluster_size": 265, "alternatives": 264},
      {"descriptor": "NaaN", "cluster_size": 38, "alternatives": 37}
    ]
  },
  "descriptors": {
    "AATS0p": {
      "cluster_id": 0,
      "pass2_cluster_id": 123,
      "pass2_cluster_size": 15,
      "alternatives": ["AATS1p", "AATS2p", ...],
      "removal_reason": "both_passes"
    }
  }
}
```

### `model_comparison.csv` êµ¬ì¡°

```csv
Rank,Model,CV_R2_Mean,CV_R2_Std,Test_R2,Test_RMSE,Test_MAE
1,XGBoost,-0.5610,0.8678,0.7527,1.3147,1.1055
2,RandomForest,-0.2543,0.4556,0.5798,1.7139,1.4458
3,LightGBM,-0.1737,0.2094,0.2153,2.3421,2.0077
...
```

### `ml_results.json` êµ¬ì¡°

```json
{
  "random_seed_search": {
    "best_seed": 4897,
    "seeds_searched": 5000,
    "descriptor_count": 35,
    "search_history": [...]
  },
  "selected_descriptors": ["AATS3v", "AATSC2d", ...],
  "ensemble_results": [...],
  "best_model": {
    "name": "XGBoost",
    "test_r2": 0.7527,
    "test_rmse": 1.3147,
    "test_mae": 1.1055
  }
}
```

---

## ë¹ ë¥¸ ì‹œì‘ ì˜ˆì œ

```bash
# 1. ì„¤ì¹˜
pip install -r requirements.txt
pip install -e .
pip install xgboost lightgbm  # ì„ íƒ

# 2. Track 2: ML í•™ìŠµ (ì˜ˆì œ ë°ì´í„°)
cdml train \
    --input reference/train_samples_61.csv \
    --test-input reference/test_samples_16.csv \
    --target-col pLeach \
    --output-dir output/track2 \
    --descriptor-sizes 30,35,40 \
    --descriptor-mode sequential

# 3. ê²°ê³¼ í™•ì¸
cat output/track2/model_comparison.csv

# 4. í”Œë¡¯ í™•ì¸
ls output/track2/*.png
```

---

## ë¬¸ì˜ ë° ì§€ì›

- GitHub: https://github.com/hyunwoo47p/descriptor-toolkit
