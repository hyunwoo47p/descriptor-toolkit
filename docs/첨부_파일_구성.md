# ChemDescriptorML (CDML) - ì²¨ë¶€ íŒŒì¼ êµ¬ì„±

ì²¨ë¶€í•œ íŒŒì¼ êµ¬ì„±ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

---

## íŒŒì¼ êµ¬ì¡°

```
descriptor-toolkit/
â”œâ”€â”€ ğŸ“ docs/                          # ë¬¸ì„œ
â”‚   â”œâ”€â”€ í”„ë¡œê·¸ë¨_êµ¬ë™ë°©ë²•.md           # í”„ë¡œê·¸ë¨ ì‚¬ìš© ê°€ì´ë“œ
â”‚   â””â”€â”€ ì²¨ë¶€_íŒŒì¼_êµ¬ì„±.md              # ë³¸ ë¬¸ì„œ
â”‚
â”œâ”€â”€ ğŸ“ Chem_Descriptor_ML/            # ë©”ì¸ íŒ¨í‚¤ì§€
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ cli.py                        # CLI ì§„ì…ì 
â”‚   â”œâ”€â”€ ğŸ“ config/                    # ì„¤ì • ê´€ë¦¬
â”‚   â”œâ”€â”€ ğŸ“ filtering/                 # í•„í„°ë§ íŒŒì´í”„ë¼ì¸
â”‚   â”œâ”€â”€ ğŸ“ preprocessing/             # ì „ì²˜ë¦¬ ëª¨ë“ˆ
â”‚   â”œâ”€â”€ ğŸ“ ml/                        # ML í•™ìŠµ ëª¨ë“ˆ
â”‚   â””â”€â”€ ğŸ“ workflows/                 # ì›Œí¬í”Œë¡œìš°
â”‚
â”œâ”€â”€ ğŸ“ example/                       # ì˜ˆì‹œ ë°ì´í„°
â”‚   â”œâ”€â”€ Ligand_U_leaching_sample.csv  # Track 1 ì…ë ¥ (77ê°œ ë¶„ì, SMILES)
â”‚   â”œâ”€â”€ train_samples_61.csv          # Track 2 í•™ìŠµ ë°ì´í„° (61ê°œ)
â”‚   â””â”€â”€ test_samples_16.csv           # Track 2 í…ŒìŠ¤íŠ¸ ë°ì´í„° (16ê°œ)
â”‚
â”œâ”€â”€ ğŸ“ output/                        # ì‹¤í–‰ ê²°ê³¼ ì˜ˆì‹œ
â”‚   â”œâ”€â”€ ğŸ“ track1_output/             # Track 1 ê²°ê³¼ (Descriptor í•„í„°ë§)
â”‚   â””â”€â”€ ğŸ“ track2_output/             # Track 2 ê²°ê³¼ (ML í•™ìŠµ)
â”‚
â”œâ”€â”€ ğŸ“ reference/                     # ì°¸ì¡° ê²°ê³¼ (ì´ì „ ì›¹ ì‹¤í—˜)
â”‚   â”œâ”€â”€ FINAL_REPORT.md               # ì‹¤í—˜ ë³´ê³ ì„œ
â”‚   â””â”€â”€ *.csv, *.png                  # ê²°ê³¼ íŒŒì¼ë“¤
â”‚
â”œâ”€â”€ setup.py                          # íŒ¨í‚¤ì§€ ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ requirements.txt                  # ì˜ì¡´ì„± ëª©ë¡
â”œâ”€â”€ CLAUDE.md                         # í”„ë¡œì íŠ¸ ì»¨í…ìŠ¤íŠ¸
â””â”€â”€ README.md                         # í”„ë¡œì íŠ¸ ì†Œê°œ
```

---

## ìƒì„¸ íŒŒì¼ ì„¤ëª…

### 00. ë¬¸ì„œ

| íŒŒì¼ | ì„¤ëª… |
|------|------|
| `docs/í”„ë¡œê·¸ë¨_êµ¬ë™ë°©ë²•.md` | í”„ë¡œê·¸ë¨ ì„¤ì¹˜ ë° ì‹¤í–‰ ë°©ë²• ìƒì„¸ ê°€ì´ë“œ |
| `docs/ì²¨ë¶€_íŒŒì¼_êµ¬ì„±.md` | ì²¨ë¶€ íŒŒì¼ êµ¬ì„± ì„¤ëª… (ë³¸ ë¬¸ì„œ) |
| `CLAUDE.md` | í”„ë¡œì íŠ¸ ì»¨í…ìŠ¤íŠ¸ ë° ê°œë°œ ì´ë ¥ |
| `README.md` | í”„ë¡œì íŠ¸ ê°œìš” |

---

### 01. Environment (í™˜ê²½ ì„¤ì •)

| íŒŒì¼ | ì„¤ëª… |
|------|------|
| `setup.py` | íŒ¨í‚¤ì§€ ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸ (`pip install -e .` ì‚¬ìš©) |
| `requirements.txt` | Python ì˜ì¡´ì„± ëª©ë¡ |

**ì£¼ìš” ì˜ì¡´ì„±:**
- `numpy>=1.24.0` - ìˆ˜ì¹˜ ì—°ì‚°
- `pandas>=2.0.0` - ë°ì´í„° ì²˜ë¦¬
- `pyarrow>=12.0.0` - Parquet íŒŒì¼ I/O
- `torch>=2.0.0` - GPU ê°€ì† (ì„ íƒ)
- `rdkit>=2023.3.1` - ë¶„ì ì²˜ë¦¬
- `mordred>=1.2.0` - Descriptor ê³„ì‚°
- `scikit-learn>=1.3.0` - ML ì•Œê³ ë¦¬ì¦˜
- `xgboost`, `lightgbm` - ë¶€ìŠ¤íŒ… ëª¨ë¸ (ì„ íƒ)

**ì„¤ì¹˜ ë°©ë²•:**
```bash
pip install -r requirements.txt
pip install -e .
pip install xgboost lightgbm  # ì„ íƒ
```

---

### 02. Code (ì½”ë“œ)

#### 2.1 ë©”ì¸ íŒ¨í‚¤ì§€ (`Chem_Descriptor_ML/`)

| íŒŒì¼/í´ë” | ì„¤ëª… |
|-----------|------|
| `cli.py` | ëª…ë ¹ì¤„ ì¸í„°í˜ì´ìŠ¤ (CLI) ì§„ì…ì  |
| `config/` | ì„¤ì • í´ë˜ìŠ¤ ì •ì˜ (DeviceConfig, IOConfig ë“±) |
| `filtering/` | 4ë‹¨ê³„ í•„í„°ë§ íŒŒì´í”„ë¼ì¸ êµ¬í˜„ |
| `preprocessing/` | ë°ì´í„° ì „ì²˜ë¦¬ (XML íŒŒì‹±, Descriptor ê³„ì‚°) |
| `ml/` | ML ëª¨ë¸ í•™ìŠµ ëª¨ë“ˆ |
| `workflows/` | í†µí•© ì›Œí¬í”Œë¡œìš° |

#### 2.2 í•„í„°ë§ íŒŒì´í”„ë¼ì¸ (`filtering/`)

| ëª¨ë“ˆ | ì„¤ëª… |
|------|------|
| `pipeline.py` | ë©”ì¸ íŒŒì´í”„ë¼ì¸ í´ë˜ìŠ¤ |
| `passes/pass0_sampling.py` | Pass 0: ë°ì´í„° ìƒ˜í”Œë§ |
| `passes/pass1_statistics.py` | Pass 1: í†µê³„ ë° ë¶„ì‚° í•„í„°ë§ |
| `passes/pass2_spearman.py` | Pass 2: Spearman ìƒê´€ ê¸°ë°˜ í´ëŸ¬ìŠ¤í„°ë§ |
| `passes/pass3_vif.py` | Pass 3: VIF ë‹¤ì¤‘ê³µì„ ì„± í•„í„°ë§ |
| `passes/pass4_nonlinear.py` | Pass 4: HSIC/RDC ë¹„ì„ í˜• ìƒê´€ í•„í„°ë§ |

#### 2.3 ML ëª¨ë“ˆ (`ml/`)

| íŒŒì¼ | ì„¤ëª… |
|------|------|
| `ensemble.py` | OptimalMLEnsemble í´ë˜ìŠ¤ - 8ê°œ ëª¨ë¸ ì•™ìƒë¸” í•™ìŠµ |

**ì§€ì› ëª¨ë¸:**
- RandomForest, ExtraTrees (íŠ¸ë¦¬ ê¸°ë°˜)
- XGBoost, LightGBM (ë¶€ìŠ¤íŒ…)
- Ridge, Lasso, ElasticNet (ì„ í˜•)
- GPR (ê°€ìš°ì‹œì•ˆ í”„ë¡œì„¸ìŠ¤)

---

### 03. Data (ë°ì´í„°)

#### 3.1 ì…ë ¥ ë°ì´í„° í˜•ì‹

| í˜•ì‹ | í™•ì¥ì | ì„¤ëª… |
|------|--------|------|
| CSV | `.csv` | SMILES ì»¬ëŸ¼ í¬í•¨ |
| Parquet | `.parquet` | SMILES ë˜ëŠ” Descriptor í¬í•¨ |
| PubChem XML | `.xml`, `.xml.gz` | PubChem ë‹¤ìš´ë¡œë“œ í˜•ì‹ |

**í•„ìˆ˜ ì»¬ëŸ¼:**
- `SMILES` ë˜ëŠ” `standardized_smiles`: ë¶„ì êµ¬ì¡°
- `CID` ë˜ëŠ” `id`: ë¶„ì ì‹ë³„ì

#### 3.2 ë¼ë²¨ ë°ì´í„° (ML í•™ìŠµìš©)

| íŒŒì¼ | ì„¤ëª… |
|------|------|
| `Labeled_descriptors.parquet` | ë¼ë²¨(pLeach)ì´ í¬í•¨ëœ descriptor ë°ì´í„° |

**ì˜ˆì‹œ ì»¬ëŸ¼:**
- `CID`: ë¶„ì ID
- `pLeach`: íƒ€ê²Ÿ ë³€ìˆ˜ (ì˜ˆì¸¡ ëŒ€ìƒ)
- `AATS0Z`, `AATS0are`, ...: Descriptor ì»¬ëŸ¼ë“¤

---

### 04. Example (ì˜ˆì‹œ ë°ì´í„°)

ì „ì²´ ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ì„ ìœ„í•œ ì˜ˆì‹œ ë°ì´í„°ì…ë‹ˆë‹¤.

| íŒŒì¼ | ìƒ˜í”Œ ìˆ˜ | ì„¤ëª… |
|------|---------|------|
| `Ligand_U_leaching_sample.csv` | 77 | **Track 1 ì…ë ¥**: SMILESê°€ í¬í•¨ëœ ì›ë³¸ ë¶„ì ë°ì´í„° |
| `train_samples_61.csv` | 61 | **Track 2 í•™ìŠµ ë°ì´í„°**: descriptorê°€ ë¯¸ë¦¬ ê³„ì‚°ëœ í•™ìŠµì…‹ |
| `test_samples_16.csv` | 16 | **Track 2 í…ŒìŠ¤íŠ¸ ë°ì´í„°**: ì™¸ë¶€ ê²€ì¦ìš© í…ŒìŠ¤íŠ¸ì…‹ |

---

### 05. Reference (ì°¸ì¡° ê²°ê³¼)

ì´ì „ ì›¹ ì‹¤í—˜ì˜ ê²°ê³¼ íŒŒì¼ë“¤ì…ë‹ˆë‹¤.

| íŒŒì¼ | ì„¤ëª… |
|------|------|
| `FINAL_REPORT.md` | ì¢…í•© ì‹¤í—˜ ë³´ê³ ì„œ |
| `model_comparison_results.csv` | ëª¨ë¸ë³„ ì„±ëŠ¥ ë¹„êµ |
| `best_configurations.csv` | ìƒìœ„ 20ê°œ ìµœì  ì„¤ì • |
| `detailed_summary_stats.csv` | ìƒì„¸ í†µê³„ |
| `comprehensive_analysis.png` | ì¢…í•© ë¶„ì„ ì‹œê°í™” |

**í•µì‹¬ ê²°ê³¼ (ì›¹ ì‹¤í—˜ - ëœë¤ ë¶„í• ):**
- ìµœì  ëª¨ë¸: **XGBoost with 30 Descriptors**
- Hold-Out RÂ²: **0.7822**
- ê·¹ë‹¨ê°’ MAE: **1.45**

---

### 06. Output (ì¶œë ¥ ê²°ê³¼)

í”„ë¡œê·¸ë¨ ì‹¤í–‰ ì‹œ ìƒì„±ë˜ëŠ” ì¶œë ¥ íŒŒì¼ë“¤ì…ë‹ˆë‹¤.

#### 6.1 Track 1 ì¶œë ¥ (Descriptor í•„í„°ë§)

`example/Ligand_U_leaching_sample.csv`ë¥¼ ì…ë ¥ìœ¼ë¡œ ì‹¤í–‰í•œ ê²°ê³¼ì…ë‹ˆë‹¤.

**í•„í„°ë§ íŒŒë¼ë¯¸í„°:**
- variance-threshold: 0.0004
- max-missing-ratio: 0.15
- min-effective-n: 10
- spearman-threshold: 0.85
- vif-threshold: 7.0

```
output/track1_output/
â”œâ”€â”€ outputs/
â”‚   â”œâ”€â”€ final_cluster_info.json         # í´ëŸ¬ìŠ¤í„° ì •ë³´ (Track 2ì—ì„œ ì‚¬ìš©)
â”‚   â”œâ”€â”€ final_descriptors.txt           # 71ê°œ ìµœì¢… descriptor ëª©ë¡
â”‚   â”œâ”€â”€ descriptors.parquet             # 77 Ã— 1775 descriptor ë°ì´í„°
â”‚   â””â”€â”€ descriptor_schema.json          # ìŠ¤í‚¤ë§ˆ
â”œâ”€â”€ train_with_new_descriptors.csv      # pLeach ë§¤ì¹­ëœ í•™ìŠµ ë°ì´í„° (61ê°œ)
â”œâ”€â”€ test_with_new_descriptors.csv       # pLeach ë§¤ì¹­ëœ í…ŒìŠ¤íŠ¸ ë°ì´í„° (16ê°œ)
â”œâ”€â”€ tmp/                                # ì¤‘ê°„ ê²°ê³¼ (Pass 0-4)
â””â”€â”€ process_all.log                     # ì‹¤í–‰ ë¡œê·¸
```

**Track 1 ê²°ê³¼:**
- ì…ë ¥: 77ê°œ ë¶„ì
- ê³„ì‚°ëœ Descriptor: 1,775ê°œ
- **ìµœì¢… Descriptor: 71ê°œ** (4ë‹¨ê³„ í•„í„°ë§ í›„)

#### 6.2 Track 2 ì¶œë ¥ (ML í•™ìŠµ)

Track 1 í´ëŸ¬ìŠ¤í„° ì •ë³´ë¥¼ í™œìš©í•˜ì—¬ 8ê°œ ëª¨ë¸ Ã— 7ê°œ descriptor í¬ê¸° = 56ê°œ ì‹¤í—˜ ìˆ˜í–‰.

```
output/track2_output/
â”œâ”€â”€ best_model.json      # ìµœê³  ëª¨ë¸: LightGBM, 10D, RÂ²=0.4993
â”œâ”€â”€ ml_results.json      # ì „ì²´ 56ê°œ ì‹¤í—˜ ê²°ê³¼
â””â”€â”€ train.log            # í•™ìŠµ ë¡œê·¸
```

**Track 2 ê²°ê³¼ (ìƒìœ„ 5ê°œ):**

| ìˆœìœ„ | ëª¨ë¸ | Descriptors | Hold-Out RÂ² |
|------|------|-------------|-------------|
| 1 | **LightGBM** | **10** | **0.4993** |
| 2 | LightGBM | 5 | 0.4899 |
| 3 | XGBoost | 10 | 0.3748 |
| 4 | RandomForest | 5 | 0.3703 |
| 5 | RandomForest | 50 | 0.3672 |

---

## ì£¼ìš” íŒŒì¼ ë‚´ìš© ì„¤ëª…

### `final_cluster_info.json` êµ¬ì¡°

```json
{
  "n_final_descriptors": 72,
  "n_total_clusters": 72,
  "descriptors": {
    "PEOE_VSA5": {
      "cluster_id": 0,
      "cluster_size": 15,
      "all_cluster_members": ["PEOE_VSA5", "SMR_VSA5", ...],
      "alternative_descriptors": ["SMR_VSA5", ...]
    },
    ...
  }
}
```

### `ml_results.json` êµ¬ì¡°

```json
[
  {
    "model_name": "XGBoost",
    "n_descriptors": 30,
    "kfold_r2_mean": 0.131,
    "kfold_r2_std": 0.33,
    "holdout_r2": 0.782,
    "holdout_rmse": 1.234,
    "overfitting_gap": -0.65,
    "extreme_high_mae": 1.45,
    "feature_importance": {...}
  },
  ...
]
```

### `best_model_optimized.json` êµ¬ì¡°

Random Seed Searchë¡œ ì°¾ì€ ìµœì  ëª¨ë¸ ì •ë³´ì…ë‹ˆë‹¤.

```json
{
  "model_name": "XGBoost",
  "descriptor_selection_seed": 986,
  "n_descriptors": 35,
  "descriptors": ["fr_Al_COO", "Chi0v", "MAXdO", ...],
  "kfold_r2_mean": -0.3259,
  "kfold_r2_std": 0.1103,
  "train_r2": 1.0000,
  "holdout_r2": 0.7323,
  "holdout_rmse": 1.3680,
  "holdout_mae": 1.1179,
  "overfitting_gap": 0.2677,
  "feature_importance": {
    "fr_Al_COO": 0.2685,
    "Chi0v": 0.1021,
    "MAXdO": 0.0949,
    ...
  }
}
```

---

## ë¹ ë¥¸ ì‹œì‘ ì˜ˆì œ

```bash
# 1. ì„¤ì¹˜
pip install -r requirements.txt
pip install -e .
pip install xgboost lightgbm  # ì„ íƒ

# 2. Track 1: Descriptor ì¶”ì¶œ ë° í•„í„°ë§
cdml process-all \
    --input example/Ligand_U_leaching_sample.csv \
    --output-dir output/track1_output \
    --smiles-col smiles \
    --id-col ligand_name \
    --variance-threshold 0.0004 \
    --max-missing-ratio 0.15 \
    --min-effective-n 10 \
    --spearman-threshold 0.85 \
    --vif-threshold 7.0 \
    --cpu

# 3. Track 2: ML í•™ìŠµ (pLeach ë§¤ì¹­ëœ ë°ì´í„° ì‚¬ìš©)
cdml train \
    --input output/track1_output/train_with_new_descriptors.csv \
    --test-input output/track1_output/test_with_new_descriptors.csv \
    --cluster-info output/track1_output/outputs/final_cluster_info.json \
    --target-col pLeach \
    --output-dir output/track2_output \
    --descriptor-sizes 5,10,15,20,30,40,50 \
    --descriptor-mode representative \
    --no-plots

# 4. ê²°ê³¼ í™•ì¸
cat output/track2_output/best_model.json
```

---

## ë¬¸ì˜ ë° ì§€ì›

- GitHub Issues: [repository URL]
- Email: your.email@kaeri.re.kr
