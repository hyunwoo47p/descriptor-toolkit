# ChemDescriptorML (CDML) - í”„ë¡œê·¸ë¨ êµ¬ë™ ë°©ë²•

## ëª©ì°¨
1. [í™˜ê²½ ì„¤ì •](#1-í™˜ê²½-ì„¤ì •)
2. [ê¸°ë³¸ ì‚¬ìš©ë²•](#2-ê¸°ë³¸-ì‚¬ìš©ë²•)
3. [Track 1: Descriptor ì¶”ì¶œ ë° í•„í„°ë§](#3-track-1-descriptor-ì¶”ì¶œ-ë°-í•„í„°ë§)
4. [Track 2: ML ëª¨ë¸ í•™ìŠµ](#4-track-2-ml-ëª¨ë¸-í•™ìŠµ)
5. [ê³ ê¸‰ ì‚¬ìš©ë²•](#5-ê³ ê¸‰-ì‚¬ìš©ë²•)
6. [ì¶œë ¥ íŒŒì¼ ì„¤ëª…](#6-ì¶œë ¥-íŒŒì¼-ì„¤ëª…)
7. [ì‹¤í–‰ ì˜ˆì‹œ](#7-ì‹¤í–‰-ì˜ˆì‹œ)
8. [ë¬¸ì œ í•´ê²°](#8-ë¬¸ì œ-í•´ê²°)

---

## 1. í™˜ê²½ ì„¤ì •

### 1.1 í•„ìˆ˜ ìš”êµ¬ì‚¬í•­
- Python 3.11 ì´ìƒ
- (ì„ íƒ) CUDA ì§€ì› GPU (ê°€ì† ì²˜ë¦¬ìš©)

### 1.2 ì„¤ì¹˜ ë°©ë²•

#### ë°©ë²• 1: pip ì„¤ì¹˜ (ê¶Œì¥)
```bash
# 1. ì˜ì¡´ì„± ë¨¼ì € ì„¤ì¹˜
pip install -r requirements.txt

# 2. íŒ¨í‚¤ì§€ ì„¤ì¹˜
pip install -e .

# 3. (ì„ íƒ) ML ë¶€ìŠ¤íŒ… ëª¨ë¸ ì„¤ì¹˜
pip install xgboost lightgbm
```

#### ë°©ë²• 2: Conda í™˜ê²½ ì‚¬ìš©
```bash
# í™˜ê²½ ìƒì„±
conda create -n cdml python=3.11
conda activate cdml

# ì˜ì¡´ì„± ì„¤ì¹˜
pip install -r requirements.txt

# íŒ¨í‚¤ì§€ ì„¤ì¹˜
pip install -e .

# (ì„ íƒ) ML ë¶€ìŠ¤íŒ… ëª¨ë¸ ì„¤ì¹˜
pip install xgboost lightgbm
```

### 1.3 ì£¼ìš” ì˜ì¡´ì„± (requirements.txt)
| íŒ¨í‚¤ì§€ | ë²„ì „ | ìš©ë„ |
|--------|------|------|
| `numpy` | >=1.24.0 | ìˆ˜ì¹˜ ì—°ì‚° |
| `pandas` | >=2.0.0 | ë°ì´í„° ì²˜ë¦¬ |
| `pyarrow` | >=12.0.0 | Parquet íŒŒì¼ I/O |
| `torch` | >=2.0.0 | GPU ê°€ì† |
| `rdkit` | >=2023.3.1 | ë¶„ì ì²˜ë¦¬ |
| `mordred` | >=1.2.0 | Descriptor ê³„ì‚° |
| `scikit-learn` | >=1.3.0 | ML ì•Œê³ ë¦¬ì¦˜ |
| `matplotlib` | >=3.7.0 | ì‹œê°í™” |
| `xgboost` | (ì„ íƒ) | XGBoost ëª¨ë¸ |
| `lightgbm` | (ì„ íƒ) | LightGBM ëª¨ë¸ |

### 1.4 ì„¤ì¹˜ í™•ì¸
```bash
cdml --version
# ì¶œë ¥: cdml 1.0.0
```

---

## 2. ê¸°ë³¸ ì‚¬ìš©ë²•

### 2.1 ëª…ë ¹ì–´ êµ¬ì¡°
```bash
cdml <ëª…ë ¹ì–´> [ì˜µì…˜ë“¤]
```

### 2.2 ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹ì–´
| ëª…ë ¹ì–´ | ì„¤ëª… |
|--------|------|
| `process-all` | í†µí•© íŒŒì´í”„ë¼ì¸ (SMILES â†’ Descriptor â†’ Filtering) |
| `run` | í•„í„°ë§ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ (Pass 0-4) |
| `filter` | ê°œë³„ í•„í„°ë§ ë‹¨ê³„ ì‹¤í–‰ |
| `preprocess` | ë°ì´í„° ì „ì²˜ë¦¬ (XML ë³€í™˜, ìŠ¤í‚¤ë§ˆ ìƒì„±, Descriptor ê³„ì‚°) |
| `train` | ML ëª¨ë¸ í•™ìŠµ |

### 2.3 ë„ì›€ë§ í™•ì¸
```bash
# ì „ì²´ ë„ì›€ë§
cdml --help

# íŠ¹ì • ëª…ë ¹ì–´ ë„ì›€ë§
cdml process-all --help
cdml train --help
```

---

## 3. Track 1: Descriptor ì¶”ì¶œ ë° í•„í„°ë§

### 3.1 í†µí•© íŒŒì´í”„ë¼ì¸ (ê¶Œì¥)

ê°€ì¥ ê°„ë‹¨í•œ ë°©ë²•ìœ¼ë¡œ, ì…ë ¥ íŒŒì¼ì—ì„œ descriptor ê³„ì‚°ê³¼ í•„í„°ë§ê¹Œì§€ í•œ ë²ˆì— ì‹¤í–‰í•©ë‹ˆë‹¤.

```bash
# CSV ì…ë ¥
cdml process-all \
    --input molecules.csv \
    --output-dir results/ \
    --smiles-col SMILES \
    --id-col CID

# Parquet ì…ë ¥
cdml process-all \
    --input molecules.parquet \
    --output-dir results/ \
    --smiles-col SMILES

# PubChem XML ì…ë ¥ (ë¶„ìëŸ‰ í•„í„°ë§ í¬í•¨)
cdml process-all \
    --input compounds.xml.gz \
    --output-dir results/ \
    --filter-property "Molecular Weight" \
    --filter-max 500

# CPU ëª¨ë“œ ê°•ì œ
cdml process-all \
    --input molecules.csv \
    --output-dir results/ \
    --cpu
```

#### `process-all` ì˜µì…˜ ìƒì„¸

| ì˜µì…˜ | ê¸°ë³¸ê°’ | ì„¤ëª… |
|------|--------|------|
| `--input` | (í•„ìˆ˜) | ì…ë ¥ íŒŒì¼ ê²½ë¡œ (.csv, .parquet, .xml, .xml.gz) |
| `--output-dir` | (í•„ìˆ˜) | ì¶œë ¥ ë””ë ‰í† ë¦¬ |
| `--smiles-col` | `SMILES::Absolute` | SMILES ì»¬ëŸ¼ëª… |
| `--id-col` | `CID` | ID ì»¬ëŸ¼ëª… |
| `--schema` | (ìë™ìƒì„±) | ìŠ¤í‚¤ë§ˆ JSON íŒŒì¼ ê²½ë¡œ |
| `--mol-timeout` | `30` | ë¶„ìë‹¹ ì²˜ë¦¬ ì œí•œ ì‹œê°„ (ì´ˆ) |
| `--cpu` | `False` | CPU ëª¨ë“œ ê°•ì œ |
| `--gpu-id` | `0` | ì‚¬ìš©í•  GPU ID |
| `--verbose` | `False` | ìƒì„¸ ì¶œë ¥ |
| `--random-seed` | `42` | ëœë¤ ì‹œë“œ |

**í•„í„°ë§ ê´€ë ¨ ì˜µì…˜:**
| ì˜µì…˜ | ê¸°ë³¸ê°’ | ì„¤ëª… |
|------|--------|------|
| `--variance-threshold` | `0.01` | ë¶„ì‚° í•„í„°ë§ ì„ê³„ê°’ |
| `--spearman-threshold` | `0.9` | Spearman ìƒê´€ê³„ìˆ˜ ì„ê³„ê°’ |
| `--vif-threshold` | `10.0` | VIF ì„ê³„ê°’ |
| `--nonlinear-threshold` | `0.85` | ë¹„ì„ í˜• ìƒê´€ ì„ê³„ê°’ (HSIC/RDC) |

**XML ì „ìš© ì˜µì…˜:**
| ì˜µì…˜ | ì„¤ëª… |
|------|------|
| `--filter-property` | í•„í„°ë§í•  ì†ì„±ëª… (ì˜ˆ: "H-Bond Donor Count") |
| `--filter-min` | ì†ì„± ìµœì†Œê°’ |
| `--filter-max` | ì†ì„± ìµœëŒ€ê°’ |

### 3.2 í•„í„°ë§ë§Œ ì‹¤í–‰

ì´ë¯¸ descriptorê°€ ê³„ì‚°ëœ parquet íŒŒì¼ì´ ìˆëŠ” ê²½ìš°:

```bash
# ì „ì²´ í•„í„°ë§ (Pass 0-4)
cdml run \
    --parquet-glob "data/*.parquet" \
    --output-dir results/

# ì†Œê·œëª¨ ë°ì´í„°ì…‹ (ìƒ˜í”Œ ìˆ˜ < 100)
cdml run \
    --parquet-glob "data/*.parquet" \
    --output-dir results/ \
    --min-effective-n 30
```

#### `run` ì˜µì…˜ ìƒì„¸

| ì˜µì…˜ | ê¸°ë³¸ê°’ | ì„¤ëª… |
|------|--------|------|
| `--parquet-glob` | (í•„ìˆ˜) | Parquet íŒŒì¼ glob íŒ¨í„´ |
| `--output-dir` | (í•„ìˆ˜) | ì¶œë ¥ ë””ë ‰í† ë¦¬ |
| `--cpu` | `False` | CPU ëª¨ë“œ ê°•ì œ |
| `--gpu-id` | `0` | GPU ì¥ì¹˜ ID |
| `--no-checkpoint` | `False` | ì²´í¬í¬ì¸íŠ¸/ì¬ì‹œì‘ ë¹„í™œì„±í™” |
| `--verbose` | `False` | ìƒì„¸ ì¶œë ¥ |
| `--random-seed` | `42` | ëœë¤ ì‹œë“œ |
| `--sample-per-file` | (ì—†ìŒ) | íŒŒì¼ë‹¹ ìƒ˜í”Œë§í•  í–‰ ìˆ˜ |
| `--min-effective-n` | `100` | ìµœì†Œ ìœ íš¨ ìƒ˜í”Œ ìˆ˜ |
| `--variance-threshold` | `0.01` | ë¶„ì‚° ì„ê³„ê°’ |
| `--spearman-threshold` | `0.9` | Spearman ìƒê´€ ì„ê³„ê°’ |
| `--vif-threshold` | `10.0` | VIF ì„ê³„ê°’ |
| `--nonlinear-threshold` | `0.85` | ë¹„ì„ í˜• ìƒê´€ ì„ê³„ê°’ |
| `--range-mode` | `minmax` | ë²”ìœ„ ê³„ì‚° ë°©ì‹ (`minmax`, `trimmed`, `iqr`) |

### 3.3 ê°œë³„ Pass ì‹¤í–‰

```bash
# Pass 0: ìƒ˜í”Œë§
cdml filter pass0 --parquet-glob "data/*.parquet" --output-dir results/

# Pass 1: í†µê³„ ë° ë¶„ì‚° í•„í„°ë§
cdml filter pass1 --parquet-glob "data/*.parquet" --output-dir results/

# Pass 2-4: ìƒê´€ í•„í„°ë§ (Spearman, VIF, HSIC/RDC)
cdml filter pass234 --parquet-glob "data/*.parquet" --output-dir results/

# ì „ì²´ Pass ì‹¤í–‰
cdml filter all --parquet-glob "data/*.parquet" --output-dir results/
```

---

## 4. Track 2: ML ëª¨ë¸ í•™ìŠµ

í•„í„°ë§ëœ descriptorë¥¼ ì‚¬ìš©í•˜ì—¬ ML ëª¨ë¸ì„ í•™ìŠµí•©ë‹ˆë‹¤.

### 4.1 ê¸°ë³¸ ì‚¬ìš©ë²•

```bash
# ê¸°ë³¸ ì‹¤í–‰ (ìë™ train/test ë¶„í• )
cdml train \
    --input Labeled_descriptors.parquet \
    --target-col pLeach \
    --output-dir ml_output/

# í´ëŸ¬ìŠ¤í„° ì •ë³´ í™œìš©
cdml train \
    --input Labeled_descriptors.parquet \
    --cluster-info outputs/final_cluster_info.json \
    --target-col pLeach \
    --output-dir ml_output/
```

### 4.2 ì™¸ë¶€ í…ŒìŠ¤íŠ¸ì…‹ ì‚¬ìš© (ì‹ ê·œ ê¸°ëŠ¥)

ë³„ë„ì˜ í…ŒìŠ¤íŠ¸ íŒŒì¼ì„ ì§€ì •í•˜ì—¬ ë” ì •í™•í•œ ì„±ëŠ¥ í‰ê°€ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤:

```bash
# ë³„ë„ train/test íŒŒì¼ ì‚¬ìš©
cdml train \
    --input train_data.parquet \
    --test-input test_data.parquet \
    --target-col pLeach \
    --output-dir ml_output/
```

> **ì°¸ê³ **: `--test-input` ì˜µì…˜ ì‚¬ìš© ì‹œ `--test-size`ëŠ” ë¬´ì‹œë©ë‹ˆë‹¤.

### 4.3 Descriptor ì„ íƒ ëª¨ë“œ

```bash
# Sequential: ì›ë³¸ ì»¬ëŸ¼ ìˆœì„œ (ê¸°ë³¸)
cdml train --input data.parquet --descriptor-mode sequential

# Representative: í´ëŸ¬ìŠ¤í„° ëŒ€í‘œ descriptor
cdml train --input data.parquet --cluster-info cluster_info.json --descriptor-mode representative

# Random Alternative: í´ëŸ¬ìŠ¤í„°ì—ì„œ ëœë¤ ì„ íƒ
cdml train --input data.parquet --cluster-info cluster_info.json --descriptor-mode random_alternative

# Mixed: ëŒ€í‘œ + ëŒ€ì•ˆ í˜¼í•©
cdml train --input data.parquet --cluster-info cluster_info.json --descriptor-mode mixed
```

### 4.4 `train` ì˜µì…˜ ìƒì„¸

| ì˜µì…˜ | ê¸°ë³¸ê°’ | ì„¤ëª… |
|------|--------|------|
| `--input` | (í•„ìˆ˜) | í•™ìŠµ ë°ì´í„° íŒŒì¼ (.parquet ë˜ëŠ” .csv) |
| `--test-input` | (ì—†ìŒ) | **ì™¸ë¶€ í…ŒìŠ¤íŠ¸ ë°ì´í„° íŒŒì¼** (ì§€ì • ì‹œ --test-size ë¬´ì‹œ) |
| `--cluster-info` | (ì—†ìŒ) | final_cluster_info.json ê²½ë¡œ |
| `--target-col` | `pLeach` | ì˜ˆì¸¡ íƒ€ê²Ÿ ì»¬ëŸ¼ëª… |
| `--output-dir` | `ml_output` | ì¶œë ¥ ë””ë ‰í† ë¦¬ |
| `--descriptor-sizes` | `5,10,15,20,30,40,50` | í…ŒìŠ¤íŠ¸í•  descriptor ê°œìˆ˜ (ì‰¼í‘œ êµ¬ë¶„) |
| `--descriptor-mode` | `sequential` | Descriptor ì„ íƒ ë°©ì‹ |
| `--models` | (ì „ì²´) | í•™ìŠµí•  ëª¨ë¸ ëª©ë¡ (ì‰¼í‘œ êµ¬ë¶„) |
| `--test-size` | `0.2` | Hold-out í…ŒìŠ¤íŠ¸ì…‹ ë¹„ìœ¨ |
| `--cv-folds` | `5` | K-Fold êµì°¨ê²€ì¦ í´ë“œ ìˆ˜ |
| `--random-seed` | `42` | ëœë¤ ì‹œë“œ |
| `--regularization` | `False` | ê°•í•œ ì •ê·œí™” ì ìš© (ì†Œê·œëª¨ ë°ì´í„°ìš©) |
| `--no-plots` | `False` | ê·¸ë˜í”„ ìƒì„± ê±´ë„ˆë›°ê¸° |

### 4.5 ì§€ì› ëª¨ë¸

| ëª¨ë¸ | ì„¤ëª… |
|------|------|
| `RandomForest` | Random Forest Regressor |
| `ExtraTrees` | Extra Trees Regressor |
| `XGBoost` | XGBoost Regressor (ì„¤ì¹˜ í•„ìš”) |
| `LightGBM` | LightGBM Regressor (ì„¤ì¹˜ í•„ìš”) |
| `Ridge` | Ridge Regression |
| `Lasso` | Lasso Regression |
| `ElasticNet` | ElasticNet Regression |
| `GPR` | Gaussian Process Regressor |

```bash
# íŠ¹ì • ëª¨ë¸ë§Œ í•™ìŠµ
cdml train --input data.parquet --models "XGBoost,RandomForest,Ridge"
```

---

## 5. ê³ ê¸‰ ì‚¬ìš©ë²•

### 5.1 ê°œë³„ ì „ì²˜ë¦¬ ë‹¨ê³„

```bash
# 1. PubChem XML â†’ Parquet ë³€í™˜
cdml preprocess xml-to-parquet \
    --input compounds.xml.gz \
    --output molecules.parquet \
    --filter-property "Molecular Weight" \
    --filter-max 500

# 2. Descriptor ìŠ¤í‚¤ë§ˆ ìƒì„±
cdml preprocess generate-schema \
    --input data_dir/ \
    --output schema.json \
    --quick

# 3. Descriptor ê³„ì‚°
cdml preprocess calculate-descriptors \
    --input molecules.parquet \
    --output descriptors/ \
    --schema schema.json \
    --timeout 60
```

### 5.2 ëŒ€ê·œëª¨ ë°ì´í„° ì²˜ë¦¬

```bash
# íŒŒì¼ë‹¹ ìƒ˜í”Œë§ (ë©”ëª¨ë¦¬ ì ˆì•½)
cdml run \
    --parquet-glob "large_data/*.parquet" \
    --output-dir results/ \
    --sample-per-file 10000

# ì²´í¬í¬ì¸íŠ¸ í™œì„±í™” (ì¤‘ë‹¨ í›„ ì¬ì‹œì‘ ê°€ëŠ¥)
cdml run \
    --parquet-glob "data/*.parquet" \
    --output-dir results/
    # ê¸°ë³¸ì ìœ¼ë¡œ ì²´í¬í¬ì¸íŠ¸ í™œì„±í™”ë¨

# ì²´í¬í¬ì¸íŠ¸ ë¹„í™œì„±í™”
cdml run \
    --parquet-glob "data/*.parquet" \
    --output-dir results/ \
    --no-checkpoint
```

### 5.3 GPU ì„¤ì •

```bash
# íŠ¹ì • GPU ì‚¬ìš©
cdml run --parquet-glob "data/*.parquet" --output-dir results/ --gpu-id 1

# CPU ê°•ì œ ì‚¬ìš©
cdml run --parquet-glob "data/*.parquet" --output-dir results/ --cpu
```

---

## 6. ì¶œë ¥ íŒŒì¼ ì„¤ëª…

### 6.1 Track 1 ì¶œë ¥ (`outputs/`)

| íŒŒì¼ëª… | ì„¤ëª… |
|--------|------|
| `pass0_sample.parquet` | Pass 0 ìƒ˜í”Œë§ ê²°ê³¼ |
| `pass1_statistics.json` | Pass 1 í†µê³„ ì •ë³´ |
| `pass1_removed.json` | Pass 1ì—ì„œ ì œê±°ëœ descriptor |
| `pass2_spearman_clusters.json` | Pass 2 Spearman í´ëŸ¬ìŠ¤í„° |
| `pass3_vif_results.json` | Pass 3 VIF ê²°ê³¼ |
| `pass4_nonlinear_results.json` | Pass 4 ë¹„ì„ í˜• ê²°ê³¼ |
| `final_descriptors.json` | ìµœì¢… ì„ íƒëœ descriptor ëª©ë¡ |
| `final_cluster_info.json` | í´ëŸ¬ìŠ¤í„° ì •ë³´ (ML í•™ìŠµìš©) |
| `pipeline_summary.json` | íŒŒì´í”„ë¼ì¸ ìš”ì•½ |

### 6.2 Track 2 ì¶œë ¥ (`ml_output/`)

| íŒŒì¼ëª… | ì„¤ëª… |
|--------|------|
| `ml_results.json` | ì „ì²´ ì‹¤í—˜ ê²°ê³¼ |
| `best_model.json` | ìµœê³  ì„±ëŠ¥ ëª¨ë¸ ì •ë³´ |
| `model_comparison_test_r2.png` | ëª¨ë¸ë³„ Test RÂ² ë¹„êµ ê·¸ë˜í”„ |
| `kfold_vs_holdout.png` | K-Fold vs Hold-Out ë¹„êµ ê·¸ë˜í”„ |
| `descriptor_count_heatmap.png` | Descriptor ìˆ˜ë³„ ì„±ëŠ¥ íˆíŠ¸ë§µ |

---

## 7. ì‹¤í–‰ ì˜ˆì‹œ

### 7.1 ì˜ˆì‹œ ë°ì´í„°ì…‹ ì •ë³´

`reference/` í´ë”ì˜ ì˜ˆì‹œ ë°ì´í„°ë¥¼ ì‚¬ìš©í•œ ì‹¤í–‰ ê²°ê³¼ì…ë‹ˆë‹¤:

| íŒŒì¼ | ìƒ˜í”Œ ìˆ˜ | ì„¤ëª… |
|------|---------|------|
| `train_samples_61.csv` | 61 | í•™ìŠµ ë°ì´í„° (863 descriptors) |
| `test_samples_16.csv` | 16 | í…ŒìŠ¤íŠ¸ ë°ì´í„° |

### 7.2 ì‹¤í–‰ ëª…ë ¹ì–´

```bash
cdml train \
    --input reference/train_samples_61.csv \
    --test-input reference/test_samples_16.csv \
    --target-col pLeach \
    --output-dir docs/examples/ml_output \
    --descriptor-sizes 5,10,15,20,30 \
    --descriptor-mode sequential
```

### 7.3 ì‹¤í–‰ ì¶œë ¥ ë¡œê·¸

```
======================================================================
ğŸ¤– ChemDescriptorML - ML Training
======================================================================

ğŸ“Š Loading data:
   Train data: reference/train_samples_61.csv
   Test data: reference/test_samples_16.csv (external)
   Target column: pLeach
Train data loaded: 61 samples, 863 descriptors
Test data loaded: 16 samples (external file)
================================================================================
OPTIMAL ML ENSEMBLE INITIALIZED
================================================================================
Train samples: 61
Test samples: 16 (external file)
Total descriptors: 863
Target: pLeach
CV Folds: 5
Regularization: OFF (default params)
================================================================================


ğŸ‹ï¸ Training models...
   Descriptor sizes: [5, 10, 15, 20, 30]
   Descriptor mode: sequential

================================================================================
TRAINING ALL MODELS
================================================================================
Models: 8 - ['RandomForest', 'ExtraTrees', 'Ridge', 'Lasso', 'ElasticNet', 'XGBoost', 'LightGBM', 'GPR']
Descriptor sizes: [5, 10, 15, 20, 30]
Descriptor mode: sequential
Total experiments: 40
================================================================================

[1/40] RandomForest - 5D
   K-Fold RÂ²=-0.4557, Hold-Out RÂ²=0.0314, Gap=0.5305

... (ì¤‘ê°„ ìƒëµ) ...

[40/40] GPR - 30D
   K-Fold RÂ²=-0.0718, Hold-Out RÂ²=-0.1235, Gap=0.1235

================================================================================
ALL MODELS TRAINED
================================================================================


ğŸ† Finding best model...

================================================================================
BEST MODEL (by holdout_r2)
================================================================================
Model: XGBoost
Descriptors: 5
K-Fold RÂ² = -0.9494 Â± 0.9461
Hold-Out RÂ² = 0.1691
Hold-Out RMSE = 2.410
Overfitting Gap = 0.8239
Extreme High MAE = 2.896
================================================================================


ğŸ’¾ Saving results to: docs/examples/ml_output

ğŸ“ˆ Generating plots...
Plots saved to docs/examples/ml_output

======================================================================
âœ… ML Training Completed!
======================================================================
ğŸ“ Output directory: docs/examples/ml_output

ğŸ“Š Best Model:
   â€¢ Model: XGBoost
   â€¢ Descriptors: 5
   â€¢ K-Fold RÂ²: -0.9494 Â± 0.9461
   â€¢ Hold-Out RÂ²: 0.1691
   â€¢ Overfitting Gap: 0.8239

ğŸ“¦ Output files:
   â€¢ ml_results.json        - All experiment results
   â€¢ best_model.json        - Best model details
   â€¢ *.png                  - Comparison plots
======================================================================
```

### 7.4 ê²°ê³¼ íŒŒì¼: best_model.json

```json
{
  "model_name": "XGBoost",
  "n_descriptors": 5,
  "descriptors": [
    "AATS0Z",
    "AATS0are",
    "AATS0d",
    "AATS0dv",
    "AATS0i"
  ],
  "kfold_r2_mean": -0.9494470978857551,
  "kfold_r2_std": 0.9461168227572895,
  "train_r2": 0.9929922898410335,
  "train_rmse": 0.36032750574058003,
  "train_mae": 0.27315692267842495,
  "holdout_r2": 0.16909353274325212,
  "holdout_rmse": 2.4100266321574715,
  "holdout_mae": 1.808667773698764,
  "overfitting_gap": 0.8238987570977814,
  "extreme_high_mae": 2.8959556323692333,
  "extreme_high_n": 3,
  "extreme_low_mae": 2.8012618960915354,
  "extreme_low_n": 3,
  "feature_importance": {
    "AATS0Z": 0.1745092272758484,
    "AATS0are": 0.20071303844451904,
    "AATS0d": 0.214433491230011,
    "AATS0dv": 0.14473210275173187,
    "AATS0i": 0.26561206579208374
  }
}
```

### 7.5 ê²°ê³¼ ê·¸ë˜í”„

ì‹¤í–‰ ê²°ê³¼ ìƒì„±ëœ ê·¸ë˜í”„ë“¤ì€ `docs/examples/ml_output/` í´ë”ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- **model_comparison_test_r2.png**: ëª¨ë¸ë³„ Test RÂ² ì„±ëŠ¥ ë¹„êµ
- **kfold_vs_holdout.png**: K-Fold CV vs Hold-Out ì„±ëŠ¥ ë¹„êµ
- **descriptor_count_heatmap.png**: Descriptor ê°œìˆ˜ë³„ ëª¨ë¸ ì„±ëŠ¥ íˆíŠ¸ë§µ

---

## 8. ë¬¸ì œ í•´ê²°

### 8.1 ì¼ë°˜ì ì¸ ì˜¤ë¥˜

**ì˜¤ë¥˜: "No descriptors remaining after Pass1"**
```bash
# í•´ê²°: ìµœì†Œ ìœ íš¨ ìƒ˜í”Œ ìˆ˜ ê°ì†Œ
cdml run --parquet-glob "data/*.parquet" --output-dir results/ --min-effective-n 30
```

**ì˜¤ë¥˜: GPU ë©”ëª¨ë¦¬ ë¶€ì¡±**
```bash
# í•´ê²°: CPU ëª¨ë“œ ì‚¬ìš© ë˜ëŠ” ìƒ˜í”Œë§
cdml run --parquet-glob "data/*.parquet" --output-dir results/ --cpu
# ë˜ëŠ”
cdml run --parquet-glob "data/*.parquet" --output-dir results/ --sample-per-file 5000
```

**ì˜¤ë¥˜: "XGBoost/LightGBM not found"**
```bash
# í•´ê²°: íŒ¨í‚¤ì§€ ì„¤ì¹˜
pip install xgboost lightgbm
```

### 8.2 ì„±ëŠ¥ ìµœì í™”

1. **GPU ì‚¬ìš©**: ê°€ëŠ¥í•œ ê²½ìš° GPU ëª¨ë“œ ì‚¬ìš© (ê¸°ë³¸)
2. **ìƒ˜í”Œë§**: ëŒ€ê·œëª¨ ë°ì´í„°ëŠ” `--sample-per-file` ì‚¬ìš©
3. **ë³‘ë ¬ ì²˜ë¦¬**: ì—¬ëŸ¬ íŒŒì¼ì€ ìë™ ë³‘ë ¬ ì²˜ë¦¬ë¨

### 8.3 ë¡œê·¸ í™•ì¸

```bash
# ìƒì„¸ ë¡œê·¸ ì¶œë ¥
cdml run --parquet-glob "data/*.parquet" --output-dir results/ --verbose
```

---

## ë¶€ë¡: ì „ì²´ ì›Œí¬í”Œë¡œìš° ì˜ˆì‹œ

### A. í†µí•© ì‹¤í–‰ (Track 1 + Track 2)

```bash
# 1. í™˜ê²½ í™œì„±í™”
conda activate cdml

# 2. Track 1: Descriptor ì¶”ì¶œ ë° í•„í„°ë§
cdml process-all \
    --input molecules.csv \
    --output-dir track1_output/ \
    --smiles-col SMILES \
    --id-col CID \
    --verbose

# 3. Track 2: ML ëª¨ë¸ í•™ìŠµ
cdml train \
    --input Labeled_descriptors.parquet \
    --cluster-info track1_output/outputs/final_cluster_info.json \
    --target-col pLeach \
    --output-dir track2_output/ \
    --descriptor-sizes "5,10,15,20,30,40,50" \
    --descriptor-mode random_alternative

# 4. ê²°ê³¼ í™•ì¸
cat track2_output/best_model.json
```

### B. ë³„ë„ Train/Test ë°ì´í„°ë¡œ ì‹¤í–‰

```bash
# 1. ML í•™ìŠµ (ë³„ë„ í…ŒìŠ¤íŠ¸ì…‹ ì‚¬ìš©)
cdml train \
    --input train_data.csv \
    --test-input test_data.csv \
    --target-col pLeach \
    --output-dir ml_results/ \
    --descriptor-sizes "5,10,15,20,30" \
    --models "XGBoost,RandomForest,Ridge,LightGBM"

# 2. ê²°ê³¼ í™•ì¸
cat ml_results/best_model.json
```
